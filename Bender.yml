# Copyright 2023 ETH Zurich and University of Bologna.
# Solderpad Hardware License, Version 0.51, see LICENSE for details.
# SPDX-License-Identifier: SHL-0.51

package:
  name: carfield
  authors:
    - "Luca Valente <luca.valente@unibo.it>"
    - "Alessandro Ottaviano <aottaviano@iis.ee.ethz.ch>"
    - "Robert Balas <balasr@iis.ee.ethz.ch>"
    - "Yvan Tortorella <yvan.tortorella@unibo.it>"

dependencies:
  register_interface: { git: https://github.com/pulp-platform/register_interface.git,   version: 0.4.3                                }
  axi:                { git: https://github.com/pulp-platform/axi.git,                  version: 0.39.1                               }
  cheshire:           { git: https://github.com/pulp-platform/cheshire.git,             rev: 2a141413e9ed1c85b41ffe03297633a394be6a42 } # branch: astral-v0
  hyperbus:           { git: https://github.com/pulp-platform/hyperbus.git,             rev: f039e601c8b6590181734e6d26ff8b77aa380412 } # branch: chi/add_fsm_with_Tcsh
  dyn_mem:            { git: https://github.com/pulp-platform/dyn_spm.git,              rev: 6753d2046da6dfc8efbef5e6f22053a621f111d9 } # branch: astral
  safety_island:      { git: https://github.com/pulp-platform/safety_island.git,        rev: aaef55c798ab53560faaf451a86668fa1e6d0f3b } # branch: carfield
  pulp_cluster:       { git: https://github.com/pulp-platform/pulp_cluster.git,         rev: 07988cd01c359a81804820135927bc04da3c25cd } # branch: astral
  opentitan:          { git: https://github.com/pulp-platform/opentitan.git,            rev: 42df2697ad3d07608df942cb7e1928c05558af26 } # branch: mc/astral
  mailbox_unit:       { git: https://github.com/pulp-platform/mailbox_unit.git,         version: 1.1.0                                }
  apb:                { git: https://github.com/pulp-platform/apb.git,                  version: 0.2.3                                }
  timer_unit:         { git: https://github.com/pulp-platform/timer_unit.git,           version: 1.0.2                                }
  apb_adv_timer:      { git: https://github.com/pulp-platform/apb_adv_timer.git,        version: 1.0.4                                }
  can_bus:            { git: https://github.com/AlSaqr-platform/can_bus.git,            rev: 0ec0bf8b7dab6d5e4b3f7ec58338a8efee066379 } # branch: pulp
  spatz:              { git: https://github.com/pulp-platform/spatz.git,                rev: 98de97f24fe42675c9b4a8cc08354a03af57400a } # branch: yt/astral
  common_cells:       { git: https://github.com/pulp-platform/common_cells.git,         version: 1.37.0                               } # branch: master        
  pulp-ethernet:      { git: https://github.com/pulp-platform/pulp-ethernet.git,        rev: db9a90dd27fa85ddbe9b7cd22e03bf43b2c14838 } # branch: handshake
  riscv-dbg:          { git: https://github.com/pulp-platform/riscv-dbg.git,            version: =0.8.0                               }
  streamer:           { path: /usr/scratch2/lagrev5/mciani/astral-project/streamer  }
  spacewire:          { path: /usr/scratch2/lagrev5/mciani/astral-project/spacewire }

workspace:
  package_links:
    cheshire: cheshire
    spatz: spatz
    safety_island: safety_island
    opentitan: opentitan
    pulp_cluster: pulp_cluster

sources:
  # Configurations
    # "Small" Astral configuration
  - target: carfield_l2dual_secure_pulp_periph_can
    files:
      - hw/configs/carfield_l2dual_secure_pulp_periph_can.sv

  - target: carfield_l2dual_secure_pulp_periph_can_ethernet_streamer_spw
    files:
      - hw/configs/carfield_l2dual_secure_pulp_periph_can_ethernet_streamer_spw.sv

  - target: carfield_l2dual_safe_secure_pulp_spatz_periph_can
    files:
      - hw/configs/carfield_l2dual_safe_secure_pulp_spatz_periph_can.sv

  - target: carfield_l2dual_periph
    files:
      - hw/configs/carfield_l2dual_periph.sv

  - target: carfield_l2dual_safe_pulp_periph
    files:
      - hw/configs/carfield_l2dual_safe_pulp_periph.sv

  - target: carfield_l2dual_pulp_periph
    files:
      - hw/configs/carfield_l2dual_pulp_periph.sv

  - target: carfield_l2dual_safe_periph
    files:
      - hw/configs/carfield_l2dual_safe_periph.sv

  - target: carfield_l2dual_spatz_periph
    files:
      - hw/configs/carfield_l2dual_spatz_periph.sv

  - target: carfield_l2dual_secure_periph
    files:
      - hw/configs/carfield_l2dual_secure_periph.sv

  - target: carfield_l2dual_safe_pulp_spatz_periph
    files:
      - hw/configs/carfield_l2dual_safe_pulp_spatz_periph.sv

  - target: carfield_l2dual_secure_pulp_periph_can
    files:
      - hw/configs/carfield_l2dual_secure_pulp_periph_can.sv

  # Source files grouped in levels. Files in level 0 have no dependencies on files in this
  # package. Files in level 1 only depend on files in level 0, files in level 2 on files in
  # levels 1 and 0, etc. Files within a level are ordered alphabetically.
  # Level 0
  - hw/carfield_pkg.sv
  - hw/carfield_chip_pkg.sv
  - hw/regs/carfield_reg_pkg.sv
  - hw/regs/carfield_reg_top.sv
  - hw/padframe/astral_padframe/src/pkg_astral_padframe.sv
  - hw/padframe/astral_padframe/src/pkg_internal_astral_padframe_periph.sv
  - hw/padframe/astral_padframe/src/astral_padframe_periph_config_reg_pkg.sv
  - hw/padframe/astral_padframe/src/astral_padframe_periph_config_reg_top.sv
  - hw/padframe/astral_padframe/src/astral_padframe_periph_pads.sv
  - hw/padframe/astral_padframe/src/astral_padframe_periph_muxer.sv
  - hw/padframe/astral_padframe/src/astral_padframe_periph.sv
  - hw/padframe/astral_padframe/src/astral_padframe.sv
  - hw/padframe/pad_behav.sv
  # Level 1
  - hw/cheshire_wrap.sv
  - hw/hyperbus_wrap.sv
  - hw/l2_wrap.sv
  - hw/ethernet_wrap.sv
  - hw/carfield_rstgen.sv
  # Level 2
  - hw/carfield.sv
  - hw/astral_wrap.sv

  - target: spatz
    files:
      - hw/spatz_cluster_wrapper.sv

  - target: test
    files:
      - target/sim/src/hyp_vip/s27ks0641.v
      - target/sim/src/vip_carfield_soc.sv
      - target/sim/src/astral_fix.sv
      - target/sim/src/astral_tb.sv

  - target: spyglass
    files:
      - utils/lint/spyglass/src/carfield_wrap.sv

  - target: all(synthesis, not(fpga))
    files:
      - tech/sourcecode/tc_clk.sv
      - tech/sourcecode/tc_sram.sv
      - tech/sourcecode/ptme_ram.sv
      - tech/sourcecode/configurable_delay.sv
      - tech/sourcecode/gf12_fll_wrap.sv

  - target: tech_sim
    files:
      # TODO: add technology dependent memory cells
      - tech/sourcecode/macros/rf_sp_uhse_rvt_mvt_128x40m2b1w0.v
      - tech/sourcecode/macros/rf_sp_uhse_rvt_mvt_256x32m2b1w1.v
      - tech/sourcecode/macros/rf_sp_uhse_rvt_mvt_256x39m4b1w0.v
      - tech/sourcecode/macros/rf_sp_uhse_rvt_mvt_256x44m2b1w1.v
      - tech/sourcecode/macros/rf_sp_uhse_rvt_mvt_256x46m2b1w1.v
      - tech/sourcecode/macros/rf_sp_uhse_rvt_mvt_256x64m2b1w1.v
      - tech/sourcecode/macros/rf_sp_uhse_rvt_mvt_256x128m2b1w1.v
      - tech/sourcecode/macros/rf_sp_uhse_rvt_mvt_256x144m1b1w0.v
      - tech/sourcecode/macros/rf_sp_uhse_rvt_mvt_512x39m4b1w0.v
      - tech/sourcecode/macros/rf_sp_uhse_rvt_mvt_1024x64m4b1w1.v
      - tech/sourcecode/macros/rf_sp_uhse_rvt_mvt_128x264m1b1w0.v
      - tech/sourcecode/macros/rf_sp_uhse_rvt_mvt_1024x39m4b1w0.v
      - tech/sourcecode/macros/sram_dp_hse_rvt_mvt_16384x8m16b8w1.v
      - tech/sourcecode/macros/sram_sp_hse_rvt_mvt_2560x76m4b4w0.v
      - tech/sourcecode/macros/sram_sp_hse_rvt_mvt_4096x76m4b4w0.v
      - tech/sourcecode/macros/sram_sp_hse_rvt_mvt_16384x39m8b8w0.v
      - tech/sourcecode/tc_sram.sv
      # FLL Model
      - tech/sourcecode/fll/rtl/FLL_digital/FLLPkg.vhd
      - tech/sourcecode/fll/rtl/FLL_digital/FLL_clk_divider.vhd
      - tech/sourcecode/fll/rtl/FLL_digital/FLL_clk_period_quantizer.vhd
      - tech/sourcecode/fll/rtl/FLL_digital/FLL_clock_gated.gf12.vhd
      - tech/sourcecode/fll/rtl/FLL_digital/FLL_clock_gated.rtl.vhd
      - tech/sourcecode/fll/rtl/FLL_digital/FLL_dither_pattern_gen.vhd
      - tech/sourcecode/fll/rtl/FLL_digital/FLL_glitchfree_clkdiv.vhd
      - tech/sourcecode/fll/rtl/FLL_digital/FLL_glitchfree_clkmux.vhd
      - tech/sourcecode/fll/rtl/FLL_digital/FLL_loop_filter.vhd
      - tech/sourcecode/fll/rtl/FLL_digital/FLL_mux.gf12.vhd
      - tech/sourcecode/fll/rtl/FLL_digital/FLL_mux.rtl.vhd
      - tech/sourcecode/fll/rtl/FLL_digital/FLL_reg.vhd
      - tech/sourcecode/fll/rtl/FLL_digital/FLL_settling_monitor.vhd
      - tech/sourcecode/fll/rtl/FLL_digital/FLL_synchroedge.vhd
      - tech/sourcecode/fll/rtl/FLL_digital/FLL_zerodelta.vhd
      - tech/sourcecode/fll/rtl/FLL_digital/FLL_digital.vhd
      - tech/sourcecode/fll/rtl/behavioral/gf12_FLL_DCO_model.tc.vhd
      #- tech/sourcecode/fll/rtl/behavioral/gf12_FLL_DCO_model.vhd
      - tech/sourcecode/fll/rtl/behavioral/gf12_FLL_model.vhd
      - tech/sourcecode/fll/rtl/behavioral/gf12_FLL.v
      - tech/sourcecode/gf12_fll_wrap.sv
      # PAD Model
      - tech/sourcecode/pad/io_gppr_12lpplus_t18_mv08_mv18_fs18_rvt_dr.v
      - tech/sourcecode/ptme_ram.sv

  - target: all(xilinx, fpga, xilinx_vanilla)
    files:
      - target/xilinx/src/cdc_dst_axi_err.sv
      - target/xilinx/flavor_vanilla/src/carfield_top_xilinx.sv
      - target/xilinx/flavor_vanilla/src/dram_wrapper_xilinx.sv
      - target/xilinx/src/overrides/tc_clk_xilinx.sv

  - target: all(xilinx, fpga, xilinx_bd)
    files:
      - target/xilinx/src/cdc_dst_axi_err.sv
      - target/xilinx/xilinx_ips/carfield_ip/src/carfield_xilinx.sv
      - target/xilinx/xilinx_ips/carfield_ip/src/carfield_xilinx_ip.v
      - target/xilinx/src/overrides/tc_clk_xilinx.sv

  - target: intel16_elab_only
    files:
      # - tech/sourcecode/macros/sram_256x32.v
      # - tech/sourcecode/macros/sram_128x40.v
      # - tech/sourcecode/macros/sram_256x128.v
      # - tech/sourcecode/macros/sram_256x44.v
      # - tech/sourcecode/macros/sram_256x46.v
      # - tech/sourcecode/tc_clk.sv
      # - tech/sourcecode/tc_sram.sv
      - nonfree/intel16/sourcecode/tc_clk.sv
      - nonfree/intel16/sourcecode/tc_sram.sv
      - nonfree/intel16/sourcecode/configurable_delay.sv
      - nonfree/intel16/sourcecode/tc_sram_impl.sv
      - nonfree/intel16/sourcecode/sync.sv

vendor_package:
  - name: reggen
    target_dir: "utils"
    upstream: { git: "https://github.com/pulp-platform/register_interface.git", rev: "19163bb5191d2669a8cbc267cdd4ce8e60f20746"}
    mapping:
      - { from: 'vendor/lowrisc_opentitan/util', to: 'reggen'}
